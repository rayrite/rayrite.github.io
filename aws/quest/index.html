<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS MCQ Practice - Question Bank & Mock Exams</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 0.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        header h1 {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            margin: 0;
        }

        .stats {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .stats span {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .dataset-selector {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
        }

        .dataset-selector label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .dataset-selector select {
            padding: 0.4rem;
            border: none;
            border-radius: 6px;
            background: white;
            color: #333;
            font-size: 0.9rem;
            min-width: 180px;
            max-width: 100%;
        }

        .dataset-selector button {
            padding: 0.4rem 0.8rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .dataset-selector button:hover {
            background: #c0392b;
        }

        .tabs {
            display: flex;
            background: #34495e;
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: transparent;
            color: #bdc3c7;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Browse Tab Styles */
        .controls {
            display: flex;
            gap: 1rem;
            padding: 0.75rem;
            background: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
        }

        .search-container {
            flex: 2;
            min-width: 200px;
        }

        .filter-container {
            flex: 1;
            min-width: 150px;
        }

        .search-container input,
        .filter-container select {
            width: 100%;
            padding: 0.6rem;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .search-container input:focus,
        .filter-container select:focus {
            outline: none;
            border-color: #3498db;
        }

        .questions-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
            align-content: start;
        }

        .question-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
            border-left: 4px solid #3498db;
            height: fit-content;
        }

        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-id {
            background: #ff9900;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .question-category {
            background: #f8f9fa;
            color: #495057;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .question-text {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #2c3e50;
        }

        .options {
            margin-bottom: 1rem;
        }

        .option {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .option-label {
            font-weight: bold;
            margin-right: 0.75rem;
            color: #ff9900;
            min-width: 25px;
        }

        .option-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .question-actions {
            margin-bottom: 0.75rem;
        }

        .show-answer-btn, .view-table-btn, .see-table-btn {
            background: #ff9900;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
            margin-top: 0.5rem;
        }

        .show-answer-btn:hover {
            background: #e6870a;
            transform: translateY(-1px);
        }

        .view-table-btn {
            background: #007bff;
        }

        .view-table-btn:hover {
            background: #0056b3;
        }

        .see-table-btn {
            background: #28a745;
        }

        .see-table-btn:hover {
            background: #218838;
        }

        .correct-answer {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            margin-top: 1rem;
        }

        .check-icon {
            background: #28a745;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 0.8rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .answer-content {
            flex: 1;
        }

        .answer-text {
            margin-bottom: 0.5rem;
            color: #155724;
            font-size: 0.9rem;
        }

        .explanation {
            color: #495057;
            font-size: 0.85rem;
            line-height: 1.5;
            background: rgba(255,255,255,0.7);
            padding: 0.75rem;
            border-radius: 4px;
        }

        .question-number-label {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-right: 0.5rem;
            margin-top: 0.5rem;
        }

        .quiz-question-id-label {
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            font-size: 0.9rem;
            color: #495057;
        }

        /* Quiz Mode Styles */
        .quiz-setup {
            padding: 2rem;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .quiz-setup h3 {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 400px;
            margin: 0 auto;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .option-group label {
            font-weight: 600;
            color: #34495e;
            text-align: left;
        }

        .option-group select,
        .option-group input {
            padding: 0.75rem;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1rem;
        }

        .start-quiz-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .quiz-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #34495e;
            color: white;
            border-radius: 8px 8px 0 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quiz-question {
            flex: 1;
            background: white;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .quiz-question .question-text {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .quiz-instructions {
            margin: 1rem 0;
            padding: 0.75rem;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }

        .quiz-instructions p {
            margin: 0;
            color: #495057;
            font-size: 0.9rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin: 0;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .quiz-option:hover {
            border-color: #ff9900;
            background: #fff9f0;
        }

        .quiz-option.selected {
            border-color: #007bff;
            background: #e7f3ff;
        }

        .quiz-option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .quiz-option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .quiz-option input {
            margin-right: 0.75rem;
            transform: scale(1.2);
            cursor: pointer;
        }

        .quiz-option-label {
            font-weight: bold;
            margin-right: 0.75rem;
            color: #000;
            min-width: 25px;
            font-size: 1rem;
        }

        .quiz-option-text {
            flex: 1;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .quiz-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            font-weight: bold;
        }

        .quiz-result.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .quiz-result.incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result-icon {
            font-size: 1.5em;
            margin-right: 0.5rem;
        }

        .quiz-actions {
            padding: 1rem;
            background: #ecf0f1;
            display: flex;
            gap: 1rem;
            justify-content: center;
            border-radius: 0 0 8px 8px;
            flex-wrap: wrap;
        }

        .quiz-actions button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .end-quiz-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .next-question-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .answer-section {
            background: #d5f4e6;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        /* Score Report Styles */
        .score-report {
            max-width: 1000px;
            margin: 0 auto;
            padding: 1rem;
            width: 100%;
        }

        .score-report-header {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            color: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .score-report-header h2 {
            color: white;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        .score-summary {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-bottom: 1.5rem;
        }

        .score-stat {
            text-align: center;
        }

        .score-stat-value {
            font-size: 3rem;
            font-weight: bold;
            color: #fff;
            display: block;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .score-stat-label {
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-top: 0.5rem;
        }

        .score-timestamp {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        .score-actions {
            margin-bottom: 2rem;
            text-align: center;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-json-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
        }

        .export-json-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(52, 152, 219, 0.4);
        }

        .back-to-quiz-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(46, 204, 113, 0.3);
        }

        .back-to-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(46, 204, 113, 0.4);
        }

        .score-report-questions {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .score-report-questions h3 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
        }

        .score-report-question {
            border-bottom: 1px solid #ecf0f1;
            padding: 1.5rem 0;
        }

        .score-report-question:last-child {
            border-bottom: none;
        }

        .score-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .score-question-number {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .score-result-badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .score-result-badge.correct {
            background: #d4edda;
            color: #155724;
        }

        .score-result-badge.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .score-question-text {
            font-size: 1.05rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            font-weight: 500;
        }

        .score-user-answer {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #6c757d;
        }

        .score-correct-answer {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #d4edda;
            border-radius: 6px;
            border-left: 3px solid #28a745;
        }

        .score-explanation {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: #e7f3ff;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }

        .score-label {
            font-weight: bold;
            margin-right: 0.5rem;
            color: #495057;
        }

        /* Table Modal Styles */
        .table-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .table-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .table-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #34495e;
            color: white;
        }

        .close-modal-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .table-modal-body {
            flex: 1;
            overflow: auto;
            padding: 1rem;
        }

        .dynamic-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .dynamic-table th,
        .dynamic-table td {
            border: 1px solid #dee2e6;
            padding: 0.75rem;
            text-align: left;
            vertical-align: top;
        }

        .dynamic-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .dynamic-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .table-metadata {
            background: #f8f9fa;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #666;
        }

        .loading, .error, .no-results {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 1rem;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
        }

        .verified {
            color: #28a745;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .unverified {
            color: #dc3545;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .questions-list {
                grid-template-columns: 1fr;
                padding: 0.5rem;
            }
            
            .question-card {
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
                gap: 0.5rem;
            }

            .search-container,
            .filter-container {
                min-width: unset;
            }

            .quiz-setup {
                padding: 1rem;
            }

            .quiz-question {
                padding: 1rem;
            }

            .header-top {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }

            .stats {
                justify-content: center;
            }

            .dataset-selector {
                flex-direction: column;
                gap: 0.5rem;
            }

            .dataset-selector select {
                min-width: unset;
                width: 100%;
            }

            .score-summary {
                flex-direction: column;
                gap: 1.5rem;
            }

            .score-stat-value {
                font-size: 2.5rem;
            }

            .score-question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .score-actions {
                flex-direction: column;
            }

            .score-report-header {
                padding: 1.5rem;
            }

            .score-report-header h2 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 0.4rem;
            }

            .tab-button {
                padding: 0.6rem;
                font-size: 0.85rem;
            }

            .question-text {
                font-size: 0.95rem;
            }

            .quiz-header {
                flex-direction: column;
                text-align: center;
            }

            .stats span {
                font-size: 0.75rem;
                padding: 0.25rem 0.6rem;
            }

            .score-stat-value {
                font-size: 2rem;
            }

            .score-report-questions {
                padding: 1rem;
            }
        }

        /* Tablet specific optimizations */
        @media (min-width: 768px) and (max-width: 1024px) {
            .questions-list {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 1rem;
                padding: 1rem;
            }

            .quiz-container {
                padding: 1.5rem;
            }
        }

        /* Lightbox styles from script.js */
        .lb-overlay {
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.85);
            display: none; 
            z-index: 9999;
        }

        .lb-overlay.active { 
            display: block; 
        }

        .lb-stage {
            position: absolute; 
            inset: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            overflow: hidden; 
            cursor: grab;
        }

        .lb-stage:active { 
            cursor: grabbing; 
        }

        .lb-img {
            max-width: 90vw; 
            max-height: 90vh; 
            user-select: none; 
            -webkit-user-drag: none;
            transform-origin: 0 0;
            will-change: transform;
            image-rendering: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            border-radius: 8px;
            background: #111;
        }

        .lb-ui {
            position: absolute; 
            top: 12px; 
            right: 12px; 
            display: flex; 
            gap: 8px; 
            z-index: 2;
        }

        .lb-btn {
            border: none; 
            border-radius: 6px; 
            padding: 6px 10px; 
            font-size: 14px;
            background: rgba(255,255,255,0.15); 
            color: #fff; 
            cursor: pointer;
        }

        .lb-btn:hover { 
            background: rgba(255,255,255,0.25); 
        }

        .lb-caption {
            position: absolute; 
            left: 16px; 
            bottom: 12px; 
            right: 16px; 
            color: #eee;
            font-size: 12px; 
            text-align: center; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>AWS MCQ Practice</h1>
                <div class="stats">
                    <span id="totalQuestions">Loading...</span>
                    <span id="totalCategories">Loading...</span>
                </div>
            </div>
            <div class="dataset-selector">
                <label for="datasetSelect">Dataset:</label>
                <select id="datasetSelect">
                    <option value="aws_mcq_questions.json">Original Question Bank (1,623 questions)</option>
                    <option value="aws_mock_exams.json">CLF-C02 Mock Exams (325 questions)</option>
                    <option value="aws_e2_exams.json">AWS Cloud Practitioner E2 (6e-390 questions)</option>
                    <option value="aws_e3_exams.json">AWS Cloud Practitioner E3 (3e-195 questions)</option>
                    <option value="aws_e4_exams.json">AWS Cloud Practitioner E4 (9e-585 questions)</option>
                    <option value="aws_e5_exams.json">ߎ AWS E5 Enhanced (252/252 verified - 100% PERFECT with bold answer letters!)</option>
                    <option value="aws_e6_exams.json">ߎ AWS E6a Truncated (1e-1000 questions)</option>
                    <option value="aws_e6b_exams.json">ߎ AWS E6b Truncated (1e-425 questions)</option>
                    <option value="aws_e7_exams.json">ߎ AWS E7 Video Mock Exam Rip (1e-65 questions)</option>
                    <option value="aws_e8_exams.json">ߎ AWS E8 Weekend Exam Cram (1e-200 questions)</option>
                </select>
                <button id="viewTablesBtn" style="display:none;">View Tables</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="browse">Question Browser</button>
            <button class="tab-button" data-tab="quiz">Quiz Mode</button>
        </div>

        <!-- Question Browser Tab -->
        <div id="browseTab" class="tab-content active">
            <div class="controls">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search questions...">
                </div>
                <div class="filter-container">
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                </div>
            </div>
            <div id="questionsList" class="questions-list">
                <!-- Questions will be populated here -->
            </div>
        </div>

        <!-- Quiz Mode Tab -->
        <div id="quizTab" class="tab-content">
            <div id="quizSetup" class="quiz-setup">
                <h3>Quiz Setup</h3>
                <div class="quiz-options">
                    <div class="option-group">
                        <label for="quizCategory">Category:</label>
                        <select id="quizCategory">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="questionCount">Number of Questions:</label>
                        <input type="number" id="questionCount" min="1" max="100" value="10">
                    </div>
                    <div class="option-group">
                        <button id="startQuiz" class="start-quiz-btn">Start Quiz</button>
                    </div>
                </div>
            </div>

            <div id="quizContainer" class="quiz-container" style="display: none;">
                <div class="quiz-header">
                    <span id="questionNumber">Question 1 of 10</span>
                    <button id="endQuiz" class="end-quiz-btn">End Quiz</button>
                </div>
                <div id="quizQuestion" class="quiz-question">
                    <!-- Quiz question will be displayed here -->
                </div>
                <div id="quizActions" class="quiz-actions">
                    <button id="checkAnswer" class="show-answer-btn">Check Answer</button>
                    <button id="showAnswer" class="show-answer-btn" style="display: none;">Show Answer</button>
                    <button id="nextQuestion" class="next-question-btn" style="display: none;">Next Question</button>
                </div>
                <div id="answerSection" class="answer-section" style="display: none;">
                    <div class="correct-answer">
                        <div class="check-icon">✓</div>
                        <div class="answer-content">
                            <div class="answer-text">
                                <strong>Correct Answer:</strong> <span id="correctAnswerText"></span>
                            </div>
                            <div id="explanationText" class="explanation"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Table Modal for displaying dynamic tables -->
    <div id="tableModal" class="table-modal" style="display: none;">
        <div class="table-modal-content">
            <div class="table-modal-header">
                <h3 id="tableModalTitle">Table Data</h3>
                <button id="closeTableModal" class="close-modal-btn">&times;</button>
            </div>
            <div id="tableModalBody" class="table-modal-body">
                <!-- Dynamic table will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        class MCQApp {
            constructor() {
                this.questions = [];
                this.filteredQuestions = [];
                this.categories = new Set();
                this.currentQuizQuestions = [];
                this.currentQuizIndex = 0;
                this.quizInProgress = false;
                this.currentDataset = 'aws_mcq_questions.json';
                this.tablesWindow = null;
                this.tablesData = null;
                this.quizResults = []; // Store quiz results for score report
                
                this.init();
            }

            async init() {
                try {
                    await this.loadQuestions();
                    await this.loadTablesData();
                    this.setupEventListeners();
                    this.populateCategories();
                    this.renderQuestions();
                    this.updateStats();
                } catch (error) {
                    console.error('Failed to initialize app:', error);
                    this.showError('Failed to load questions. Please refresh the page.');
                }
            }

            async loadTablesData() {
                try {
                    const response = await fetch('aws_mcq_tables.json');
                    if (response?.ok) {
                        this.tablesData = await response.json() ?? [];
                        console.log('Tables data loaded:', this.tablesData.length, 'tables');
                    } else {
                        console.warn('Could not load aws_mcq_tables.json - tables functionality will be limited');
                        this.tablesData = [];
                    }
                } catch (error) {
                    console.warn('Error loading tables data:', error);
                    this.tablesData = [];
                }
            }

            async loadQuestions() {
                try {
                    const response = await fetch(this.currentDataset);
                    if (!response?.ok) {
                        throw new Error(`HTTP error! status: ${response?.status ?? 'unknown'}`);
                    }
                    this.questions = await response.json() ?? [];
                    
                    // Derive answer_letters for all questions based on their correct_answers format
                    this.questions.forEach(q => {
                        if (q.answer_letters && q.answer_letters.length > 0) {
                            // Already has answer_letters, keep them
                            return;
                        }

                        const letters = [];
                        const correctAnswers = q.correct_answers || [];
                        
                        correctAnswers.forEach(answer => {
                            // Handle different formats of correct_answers
                            
                            // Format 1: "B. Amazon DynamoDB" (aws_mcq_questions.json)
                            let match = answer.match(/^([A-Z])\.\s*/);
                            if (match) {
                                letters.push(match[1]);
                                return;
                            }
                            
                            // Format 2: "<b>A. The ability...</b>" (aws_e5_exams.json)
                            match = answer.match(/<b>([A-Z])\.\s*/);
                            if (match) {
                                letters.push(match[1]);
                                return;
                            }
                            
                            // Format 3: Split by <br> and look for letter patterns (aws_mcq_questions.json legacy)
                            answer.split('<br>').forEach(item => {
                                const m = item.trim().match(/^([A-Z])\./);
                                if (m) letters.push(m[1]);
                            });
                            
                            // Format 4: Plain answer text - match against options (aws_e2, aws_e3, aws_e6, aws_mock_exams)
                            if (letters.length === 0 && q.options) {
                                // Find which option matches this answer
                                const cleanAnswer = answer.replace(/<[^>]*>/g, '').trim(); // Remove HTML tags
                                q.options.forEach((option, index) => {
                                    const cleanOption = option.replace(/<[^>]*>/g, '').trim();
                                    if (cleanOption === cleanAnswer) {
                                        letters.push(String.fromCharCode(65 + index)); // A, B, C, D...
                                    }
                                });
                            }
                        });
                        
                        // Remove duplicates and sort
                        q.answer_letters = [...new Set(letters)].sort();
                    });
                    
                    this.filteredQuestions = [...this.questions];
                    
                    this.categories.clear();
                    this.questions?.forEach?.(q => {
                        if (q?.category) {
                            this.categories.add(q.category);
                        }
                    });
                } catch (error) {
                    console.error('Error loading questions:', error);
                    throw error;
                }
            }

            async switchDataset(newDataset) {
                try {
                    this.currentDataset = newDataset;
                    this.showLoading();
                    await this.loadQuestions();
                    this.resetFilters();
                    this.populateCategories();
                    this.renderQuestions();
                    this.updateStats();
                    this.hideLoading();
                    
                    if (this.quizInProgress) {
                        this.endQuiz();
                    }
                } catch (error) {
                    console.error('Failed to switch dataset:', error);
                    this.showError('Failed to load the selected dataset. Please try again.');
                    this.hideLoading();
                }
            }

            setupEventListeners() {
                document.getElementById('datasetSelect')?.addEventListener?.('change', (e) => {
                    const selectedDataset = e?.target?.value;
                    if (selectedDataset && selectedDataset !== this.currentDataset) {
                        this.switchDataset(selectedDataset);
                    }
                });

                document.getElementById('searchInput')?.addEventListener?.('input', (e) => {
                    this.filterQuestions();
                });

                document.getElementById('categoryFilter')?.addEventListener?.('change', (e) => {
                    this.filterQuestions();
                });

                document.querySelectorAll('.tab-button')?.forEach?.(button => {
                    button?.addEventListener?.('click', (e) => {
                        const tabName = e?.target?.dataset?.tab;
                        if (tabName) {
                            this.switchTab(tabName);
                        }
                    });
                });

                document.getElementById('startQuiz')?.addEventListener?.('click', () => {
                    this.startQuiz();
                });

                document.getElementById('endQuiz')?.addEventListener?.('click', () => {
                    this.endQuiz();
                });

                document.getElementById('checkAnswer')?.addEventListener?.('click', () => {
                    this.checkUserAnswer();
                });

                document.getElementById('showAnswer')?.addEventListener?.('click', () => {
                    this.showCurrentAnswer();
                });

                document.getElementById('nextQuestion')?.addEventListener?.('click', () => {
                    this.nextQuizQuestion();
                });

                const datasetSelect = document.getElementById('datasetSelect');
                const viewTablesBtn = document.getElementById('viewTablesBtn');
                if (viewTablesBtn && datasetSelect) {
                    viewTablesBtn.addEventListener('click', () => {
                        window.open('aws1600t.html', '_blank');
                    });
                    const toggleViewTablesBtn = () => {
                        if (datasetSelect.value === 'aws_mcq_questions.json') {
                            viewTablesBtn.style.display = 'inline-block';
                        } else {
                            viewTablesBtn.style.display = 'none';
                        }
                    };
                    datasetSelect.addEventListener('change', toggleViewTablesBtn);
                    toggleViewTablesBtn();
                }

                const closeModalBtn = document.getElementById('closeTableModal');
                const tableModal = document.getElementById('tableModal');
                
                if (closeModalBtn) {
                    closeModalBtn.addEventListener('click', () => {
                        this.closeTableModal();
                    });
                }
                
                if (tableModal) {
                    tableModal.addEventListener('click', (e) => {
                        if (e.target === tableModal) {
                            this.closeTableModal();
                        }
                    });
                }

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeTableModal();
                    }
                });
            }

            resetFilters() {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.value = '';
                }
                
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {
                    categoryFilter.value = '';
                }
                
                this.filteredQuestions = [...this.questions];
            }

            showLoading() {
                const questionsList = document.getElementById('questionsList');
                if (questionsList) {
                    questionsList.innerHTML = '<div class="loading">Loading questions...</div>';
                }
            }

            hideLoading() {
                // Loading state will be hidden when questions are rendered
            }

            showError(message) {
                const questionsList = document.getElementById('questionsList');
                if (questionsList) {
                    questionsList.innerHTML = `<div class="error">${message}</div>`;
                }
            }

            populateCategories() {
                const categoryFilter = document.getElementById('categoryFilter');
                const quizCategory = document.getElementById('quizCategory');
                
                if (categoryFilter) {
                    categoryFilter.innerHTML = '<option value="">All Categories</option>';
                    [...this.categories]?.sort()?.forEach?.(category => {
                        if (category) {
                            const option = document.createElement('option');
                            option.value = category;
                            option.textContent = category;
                            categoryFilter.appendChild(option);
                        }
                    });
                }

                if (quizCategory) {
                    quizCategory.innerHTML = '<option value="">All Categories</option>';
                    [...this.categories]?.sort()?.forEach?.(category => {
                        if (category) {
                            const option = document.createElement('option');
                            option.value = category;
                            option.textContent = category;
                            quizCategory.appendChild(option);
                        }
                    });
                }
            }

            updateStats() {
                const totalQuestions = document.getElementById('totalQuestions');
                const totalCategories = document.getElementById('totalCategories');
                
                if (totalQuestions) {
                    totalQuestions.textContent = `${this.questions?.length ?? 0} Questions`;
                }
                
                if (totalCategories) {
                    totalCategories.textContent = `${this.categories?.size ?? 0} Categories`;
                }
            }

            filterQuestions() {
                const searchTerm = document.getElementById('searchInput')?.value?.toLowerCase() ?? '';
                const selectedCategory = document.getElementById('categoryFilter')?.value ?? '';

                this.filteredQuestions = this.questions?.filter?.(q => {
                    const matchesSearch = !searchTerm || 
                        q?.question?.toLowerCase()?.includes?.(searchTerm) ||
                        q?.options?.some?.(option => option?.toLowerCase()?.includes?.(searchTerm));
                    
                    const matchesCategory = !selectedCategory || q?.category === selectedCategory;
                    
                    return matchesSearch && matchesCategory;
                }) ?? [];

                this.renderQuestions();
            }

            renderQuestions() {
                const questionsList = document.getElementById('questionsList');
                if (!questionsList) return;

                if (!this.filteredQuestions?.length) {
                    questionsList.innerHTML = '<div class="no-results">No questions found matching your criteria.</div>';
                    return;
                }

                questionsList.innerHTML = this.filteredQuestions?.map?.(q => this.createQuestionCard(q))?.join?.('') ?? '';
            }

            createQuestionCard(question) {
                // Format correct answers for display
                let correctAnswersDisplay = '';
                if (question.answer_letters && question.answer_letters.length > 0) {
                    // Show letter-based answers with the actual option text
                    const answerTexts = question.answer_letters.map(letter => {
                        const optionIndex = letter.charCodeAt(0) - 65; // A=0, B=1, etc.
                        const optionText = question.options?.[optionIndex] || letter;
                        return `${letter}. ${optionText}`;
                    });
                    correctAnswersDisplay = answerTexts.join(', ');
                } else if (question.correct_answers && question.correct_answers.length > 0) {
                    // Clean up HTML tags and show raw answers
                    correctAnswersDisplay = question.correct_answers
                        .map(answer => answer.replace(/<[^>]*>/g, '').trim())
                        .join(', ');
                } else {
                    correctAnswersDisplay = 'No answer provided';
                }

                const hasExplanation = question?.explanation && question.explanation.trim() !== '';
                
                const chapterMap = {
                    'Assessment Test': 'A',
                    'Chapter 1': '1',
                    'Chapter 2': '2',
                    'Chapter 3': '3',
                    'Chapter 4': '4',
                    'Chapter 5': '5',
                    'Chapter 6': '6',
                    'Chapter 7': '7',
                    'Chapter 8': '8',
                    'Chapter 9': '9',
                    'Chapter 10': '10',
                    'Chapter 11': '11',
                    'Chapter 12': '12'
                };
                let questionNumber;
                if (question.chapter && chapterMap[question.chapter] && question.pdf_question_number) {
                    questionNumber = `${chapterMap[question.chapter]}${question.pdf_question_number.toString().padStart(2, '0')}`;
                } else {
                    questionNumber = question.id;
                }
                    
                const verificationStatus = question?.answer_verified !== undefined ? 
                    (question.answer_verified ? 
                        `<span class="verified" title="Answer verified">✅</span>` : 
                        `<span class="unverified" title="Answer not verified">❌</span>`
                    ) : '';

                const viewTableButton = this.currentDataset === 'aws_mcq_questions.json' ? 
                    `<button class="view-table-btn" onclick="app.openTableForQuestion(${question?.id ?? 0})">View Table</button>` : '';
                
                const tableControls = this.currentDataset === 'aws_mcq_questions.json' ? 
                    `<span class="question-number-label">Question ${question?.id ?? 'N/A'}</span>
                     <button class="see-table-btn" onclick="app.showTableForQuestion(${question?.id ?? 0})">See Table</button>` : '';
                
                return `
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-id">${questionNumber}</span>
                            <span class="question-category">${question?.category ?? 'Uncategorized'}</span>
                            ${verificationStatus}
                        </div>
                        <div class="question-text">${question?.question ?? 'Question text not available'}</div>
                        <div class="options">
                            ${question?.options?.map?.((option, index) => 
                                `<div class="option">
                                    <span class="option-label">${String.fromCharCode(65 + index)})</span>
                                    <span class="option-text">${option ?? ''}</span>
                                </div>`
                            )?.join?.('') ?? ''}
                        </div>
                        <div class="question-actions">
                            <button class="show-answer-btn" onclick="app.toggleAnswer(${question?.id ?? 0})">
                                Show Answer
                            </button>
                        </div>
                        <div id="answer-${question?.id ?? 0}" class="correct-answer" style="display: none;">
                            <div class="check-icon">✓</div>
                            <div class="answer-content">
                                <div class="answer-text">
                                    <strong>Correct Answer:</strong> ${correctAnswersDisplay}
                                </div>
                                ${hasExplanation ? `<div class="explanation">${question.explanation.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: #007bff; text-decoration: underline;">$1</a>')}</div>` : ''}
                                ${tableControls}
                                ${viewTableButton}
                            </div>
                        </div>
                    </div>
                `;
            }

            showTableForQuestion(questionId) {
                if (!this.tablesData || !Array.isArray(this.tablesData)) {
                    alert('Table data not available. Please ensure aws_mcq_tables.json is loaded.');
                    return;
                }

                const tableEntry = this.tablesData.find(entry => entry.question === questionId.toString());
                
                if (!tableEntry) {
                    alert(`No table data found for question ${questionId}`);
                    return;
                }

                this.displayTableModal(tableEntry, questionId);
            }

            displayTableModal(tableEntry, questionId) {
                const modal = document.getElementById('tableModal');
                const title = document.getElementById('tableModalTitle');
                const body = document.getElementById('tableModalBody');
                
                if (!modal || !title || !body) {
                    console.error('Table modal elements not found');
                    return;
                }

                title.textContent = `Table for Question ${questionId}`;

                const metadata = tableEntry.metadata || {};
                const metadataHtml = `
                    <div class="table-metadata">
                        <strong>Table Information:</strong><br>
                        ${metadata.page_number ? `Page: ${metadata.page_number}${metadata.end_page && metadata.end_page !== metadata.page_number ? `-${metadata.end_page}` : ''}` : ''}
                        ${metadata.table_number ? ` | Table #${metadata.table_number}` : ''}
                        ${metadata.dimensions ? ` | Size: ${metadata.dimensions.rows}×${metadata.dimensions.columns}` : ''}
                    </div>
                `;

                const tableHtml = this.createTableHTML(tableEntry);
                body.innerHTML = metadataHtml + tableHtml;
                modal.style.display = 'flex';
            }

            createTableHTML(tableEntry) {
                if (!tableEntry.headers || !tableEntry.data) {
                    return '<p>Invalid table data structure</p>';
                }

                let html = '<table class="dynamic-table">';
                
                html += '<thead><tr>';
                tableEntry.headers.forEach(header => {
                    const formattedHeader = header.replace(/\n/g, '<br>');
                    html += `<th>${formattedHeader}</th>`;
                });
                html += '</tr></thead>';
                
                html += '<tbody>';
                tableEntry.data.forEach(row => {
                    html += '<tr>';
                    row.forEach(cell => {
                        const formattedCell = cell.replace(/\n/g, '<br>');
                        html += `<td>${formattedCell}</td>`;
                    });
                    html += '</tr>';
                });
                html += '</tbody>';
                
                html += '</table>';
                return html;
            }

            closeTableModal() {
                const modal = document.getElementById('tableModal');
                if (modal) {
                    modal.style.display = 'none';
                }
            }

            openTableForQuestion(questionId) {
                const url = `aws1600t.html#question-${questionId}`;
                
                if (this.tablesWindow && !this.tablesWindow.closed) {
                    this.tablesWindow.location.href = url;
                    this.tablesWindow.focus();
                    setTimeout(() => {
                        this.tablesWindow.focus();
                    }, 100);
                } else {
                    this.tablesWindow = window.open(url, 'tablesWindow', 'width=1200,height=800,scrollbars=yes,resizable=yes');
                    if (this.tablesWindow) {
                        this.tablesWindow.focus();
                    }
                }
            }

            toggleAnswer(questionId) {
                const answerDiv = document.getElementById(`answer-${questionId}`);
                const button = document.querySelector(`button[onclick="app.toggleAnswer(${questionId})"]`);
                
                if (answerDiv && button) {
                    if (answerDiv.style.display === 'none') {
                        answerDiv.style.display = 'flex';
                        button.textContent = 'Hide Answer';
                    } else {
                        answerDiv.style.display = 'none';
                        button.textContent = 'Show Answer';
                    }
                }
            }

            switchTab(tabName) {
                document.querySelectorAll('.tab-button')?.forEach?.(btn => {
                    btn?.classList?.remove?.('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`)?.classList?.add?.('active');

                document.querySelectorAll('.tab-content')?.forEach?.(content => {
                    content?.classList?.remove?.('active');
                });
                document.getElementById(`${tabName}Tab`)?.classList?.add?.('active');
            }

            startQuiz() {
                const selectedCategory = document.getElementById('quizCategory')?.value ?? '';
                const questionCount = parseInt(document.getElementById('questionCount')?.value ?? '10');

                let availableQuestions = selectedCategory 
                    ? this.questions?.filter?.(q => q?.category === selectedCategory) ?? []
                    : [...this.questions];

                if (!availableQuestions?.length) {
                    alert('No questions available for the selected category.');
                    return;
                }

                this.currentQuizQuestions = this.shuffleArray(availableQuestions)?.slice?.(0, questionCount) ?? [];
                this.currentQuizIndex = 0;
                this.quizInProgress = true;
                this.quizResults = []; // Reset quiz results

                document.getElementById('quizSetup')?.style?.setProperty?.('display', 'none');
                document.getElementById('quizContainer')?.style?.setProperty?.('display', 'block');

                this.displayCurrentQuizQuestion();
            }

            endQuiz() {
                this.quizInProgress = false;
                this.currentQuizQuestions = [];
                this.currentQuizIndex = 0;
                this.quizResults = [];

                document.getElementById('quizSetup')?.style?.setProperty?.('display', 'block');
                document.getElementById('quizContainer')?.style?.setProperty?.('display', 'none');
            }

            displayCurrentQuizQuestion() {
                const question = this.currentQuizQuestions?.[this.currentQuizIndex];
                if (!question) return;

                const questionNumber = document.getElementById('questionNumber');
                if (questionNumber) {
                    questionNumber.textContent = `Question ${this.currentQuizIndex + 1} of ${this.currentQuizQuestions?.length ?? 0}`;
                }

                const isMultipleChoice = question?.answer_letters?.length > 1;
                const inputType = isMultipleChoice ? 'checkbox' : 'radio';

                const quizQuestion = document.getElementById('quizQuestion');
                if (quizQuestion) {
                    quizQuestion.innerHTML = `
                        <div class="question-text">${question?.question ?? 'Question not available'}</div>
                        <div class="quiz-instructions">
                            ${isMultipleChoice ? 
                                `<p><strong>Select ${question.answer_letters.length} answers:</strong></p>` : 
                                '<p><strong>Select one answer:</strong></p>'
                            }
                        </div>
                        <div class="quiz-options">
                            ${question?.options?.map?.((option, index) => {
                                const letter = String.fromCharCode(65 + index);
                                return `
                                    <div class="quiz-option" onclick="app.toggleQuizOption('${letter}')">
                                        <input type="${inputType}" 
                                               id="option-${letter}" 
                                               name="quiz-answer" 
                                               value="${letter}" 
                                               ${inputType === 'radio' ? '' : ''}>
                                        <span class="quiz-option-label">${letter}.</span>
                                        <span class="quiz-option-text">${option ?? ''}</span>
                                    </div>
                                `;
                            })?.join?.('') ?? ''}
                        </div>
                    `;
                }

                document.getElementById('answerSection')?.style?.setProperty?.('display', 'none');
                document.getElementById('checkAnswer')?.style?.setProperty?.('display', 'inline-block');
                document.getElementById('showAnswer')?.style?.setProperty?.('display', 'none');
                document.getElementById('nextQuestion')?.style?.setProperty?.('display', 'none');
                
                const existingResult = document.querySelector('.quiz-result');
                if (existingResult) {
                    existingResult.remove();
                }
            }

            showCurrentAnswer() {
                const question = this.currentQuizQuestions?.[this.currentQuizIndex];
                if (!question) return;

                // Format correct answers for display
                let correctAnswersDisplay = '';
                if (question.answer_letters && question.answer_letters.length > 0) {
                    // Show letter-based answers
                    correctAnswersDisplay = question.answer_letters.join(', ');
                } else if (question.correct_answers && question.correct_answers.length > 0) {
                    // Fallback to raw correct_answers
                    correctAnswersDisplay = question.correct_answers.join(', ');
                } else {
                    correctAnswersDisplay = 'No answer provided';
                }

                // Clean up HTML tags from explanation for better display
                const explanation = question?.explanation ? 
                    question.explanation.replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]*>/g, '') : '';
                const hasExplanation = explanation && explanation.trim() !== '';

                const correctAnswerText = document.getElementById('correctAnswerText');
                if (correctAnswerText) {
                    correctAnswerText.innerHTML = correctAnswersDisplay;
                }

                const explanationText = document.getElementById('explanationText');
                if (hasExplanation) {
                    // Convert newlines back to <br> for HTML display and make URLs clickable
                    let formattedExplanation = explanation.replace(/\n/g, '<br>');
                    formattedExplanation = formattedExplanation.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: #007bff; text-decoration: underline;">$1</a>');
                    explanationText.innerHTML = formattedExplanation;
                    explanationText.style.display = 'block';
                } else {
                    explanationText.innerHTML = '';
                    explanationText.style.display = 'none';
                }

                // Add question ID display for all datasets in quiz mode
                const answerSection = document.getElementById('answerSection');
                if (answerSection && question.id) {
                    // Remove existing question number labels to avoid duplicates
                    const existingLabels = answerSection.querySelectorAll('.quiz-question-id-label');
                    existingLabels.forEach(label => label.remove());

                    const questionIdLabel = document.createElement('div');
                    questionIdLabel.className = 'quiz-question-id-label';
                    questionIdLabel.innerHTML = `<strong>Question ID:</strong> ${question.id}`;
                    questionIdLabel.style.cssText = `
                        margin-top: 1rem;
                        padding: 0.5rem;
                        background: rgba(0,0,0,0.1);
                        border-radius: 4px;
                        font-size: 0.9rem;
                        color: #495057;
                    `;
                    answerSection.appendChild(questionIdLabel);
                }

                // Add table controls only for aws_mcq_questions.json dataset in quiz mode
                if (this.currentDataset === 'aws_mcq_questions.json' && question.id) {
                    if (answerSection) {
                        // Remove existing table controls to avoid duplicates
                        const existingControls = answerSection.querySelectorAll('.question-number-label, .see-table-btn, .view-table-btn');
                        existingControls.forEach(control => control.remove());

                        // Add question number label
                        const questionLabel = document.createElement('span');
                        questionLabel.className = 'question-number-label';
                        questionLabel.textContent = `Question ${question.id}`;
                        answerSection.appendChild(questionLabel);

                        // Add See Table button
                        const seeTableBtn = document.createElement('button');
                        seeTableBtn.className = 'see-table-btn';
                        seeTableBtn.textContent = 'See Table';
                        seeTableBtn.onclick = () => this.showTableForQuestion(question.id);
                        answerSection.appendChild(seeTableBtn);

                        // Add View Table button
                        const viewTableBtn = document.createElement('button');
                        viewTableBtn.className = 'view-table-btn';
                        viewTableBtn.textContent = 'View Table';
                        viewTableBtn.onclick = () => this.openTableForQuestion(question.id);
                        answerSection.appendChild(viewTableBtn);
                    }
                }

                // Show answer section and next button
                document.getElementById('answerSection')?.style?.setProperty?.('display', 'block');
                document.getElementById('showAnswer')?.style?.setProperty?.('display', 'none');
                document.getElementById('nextQuestion')?.style?.setProperty?.('display', 'inline-block');
            }

            nextQuizQuestion() {
                this.currentQuizIndex++;
                
                if (this.currentQuizIndex >= (this.currentQuizQuestions?.length ?? 0)) {
                    // Show score report instead of alert
                    this.showScoreReport();
                } else {
                    this.displayCurrentQuizQuestion();
                }
            }

            toggleQuizOption(letter) {
                const question = this.currentQuizQuestions?.[this.currentQuizIndex];
                if (!question) return;

                const isMultipleChoice = question?.answer_letters?.length > 1;
                const checkbox = document.getElementById(`option-${letter}`);
                const option = checkbox?.closest('.quiz-option');

                if (!checkbox || !option) return;

                if (isMultipleChoice) {
                    checkbox.checked = !checkbox.checked;
                    option.classList.toggle('selected', checkbox.checked);
                } else {
                    document.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('selected');
                        const input = opt.querySelector('input');
                        if (input) input.checked = false;
                    });
                    
                    checkbox.checked = true;
                    option.classList.add('selected');
                }
            }

            checkUserAnswer() {
                const question = this.currentQuizQuestions?.[this.currentQuizIndex];
                if (!question) return;

                const selectedInputs = document.querySelectorAll('.quiz-option input:checked');
                const userAnswers = Array.from(selectedInputs).map(input => input.value).sort();
                const correctAnswers = [...(question?.answer_letters || [])].sort();

                if (userAnswers.length === 0) {
                    alert('Please select an answer before checking.');
                    return;
                }

                const isCorrect = JSON.stringify(userAnswers) === JSON.stringify(correctAnswers);

                // Store the result for this question
                const result = {
                    questionIndex: this.currentQuizIndex,
                    question: question,
                    userAnswers: userAnswers,
                    correctAnswers: correctAnswers,
                    isCorrect: isCorrect,
                    timestamp: new Date().toISOString()
                };
                this.quizResults.push(result);

                document.querySelectorAll('.quiz-option').forEach(option => {
                    const input = option.querySelector('input');
                    const letter = input?.value;
                    
                    if (correctAnswers.includes(letter)) {
                        option.classList.add('correct');
                    } else if (userAnswers.includes(letter)) {
                        option.classList.add('incorrect');
                    }
                    
                    option.style.pointerEvents = 'none';
                    if (input) input.disabled = true;
                });

                this.showQuizResult(isCorrect, question);
                this.showCurrentAnswer();

                document.getElementById('checkAnswer')?.style?.setProperty?.('display', 'none');
                document.getElementById('showAnswer')?.style?.setProperty?.('display', 'none');
                document.getElementById('nextQuestion')?.style?.setProperty?.('display', 'inline-block');
            }

            showQuizResult(isCorrect, question) {
                const resultDiv = document.createElement('div');
                resultDiv.className = `quiz-result ${isCorrect ? 'correct' : 'incorrect'}`;
                
                const icon = isCorrect ? '✓' : '✗';
                const message = isCorrect ? 'Correct!' : 'Incorrect!';
                
                // Format correct answers for display
                let correctAnswersText = '';
                if (question?.answer_letters?.length > 0) {
                    correctAnswersText = question.answer_letters.join(', ');
                } else if (question?.correct_answers?.length > 0) {
                    // Try to extract letters from correct_answers if answer_letters not available
                    const letters = [];
                    question.correct_answers.forEach(answer => {
                        // Look for letter patterns
                        let match = answer.match(/^([A-Z])\.\s*/);
                        if (match) {
                            letters.push(match[1]);
                            return;
                        }
                        match = answer.match(/<b>([A-Z])\.\s*/);
                        if (match) {
                            letters.push(match[1]);
                            return;
                        }
                        // If no letter pattern, try to find matching option
                        const cleanAnswer = answer.replace(/<[^>]*>/g, '').trim();
                        question.options?.forEach((option, index) => {
                            const cleanOption = option.replace(/<[^>]*>/g, '').trim();
                            if (cleanOption === cleanAnswer) {
                                letters.push(String.fromCharCode(65 + index));
                            }
                        });
                    });
                    correctAnswersText = [...new Set(letters)].sort().join(', ');
                } else {
                    correctAnswersText = 'N/A';
                }
                
                resultDiv.innerHTML = `
                    <span class="result-icon">${icon}</span>
                    ${message}
                    ${!isCorrect ? `<br><strong>Correct answer(s): ${correctAnswersText}</strong>` : ''}
                `;

                const quizQuestion = document.getElementById('quizQuestion');
                if (quizQuestion) {
                    quizQuestion.appendChild(resultDiv);
                }
            }

            showScoreReport() {
                // Hide quiz container
                document.getElementById('quizContainer')?.style?.setProperty?.('display', 'none');
                
                // Create or show score report
                let scoreReportDiv = document.getElementById('scoreReport');
                if (!scoreReportDiv) {
                    scoreReportDiv = document.createElement('div');
                    scoreReportDiv.id = 'scoreReport';
                    scoreReportDiv.className = 'tab-content';
                    document.getElementById('quizTab').appendChild(scoreReportDiv);
                }
                
                // Calculate statistics
                const totalQuestions = this.quizResults.length;
                const correctAnswers = this.quizResults.filter(r => r.isCorrect).length;
                const score = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
                const timestamp = new Date().toLocaleString();
                
                // Build score report HTML
                let scoreReportHTML = `
                    <div class="score-report">
                        <div class="score-report-header">
                            <h2>Quiz Results</h2>
                            <div class="score-summary">
                                <div class="score-stat">
                                    <span class="score-stat-value">${score}%</span>
                                    <span class="score-stat-label">Score</span>
                                </div>
                                <div class="score-stat">
                                    <span class="score-stat-value">${correctAnswers}/${totalQuestions}</span>
                                    <span class="score-stat-label">Correct Answers</span>
                                </div>
                            </div>
                            <div class="score-timestamp">Completed: ${timestamp}</div>
                        </div>
                        
                        <div class="score-actions">
                            <button class="export-json-btn" onclick="app.exportScoreReport()">Export to JSON</button>
                            <button class="back-to-quiz-btn" onclick="app.backToQuizSetup()">Start New Quiz</button>
                        </div>
                        
                        <div class="score-report-questions">
                            <h3>Question Review</h3>
                `;
                
                // Add each question result
                this.quizResults.forEach((result, index) => {
                    const question = result.question;
                    const userAnswerTexts = result.userAnswers.map(letter => {
                        const optionIndex = letter.charCodeAt(0) - 65;
                        return `${letter}. ${question.options[optionIndex]}`;
                    }).join(', ');
                    
                    const correctAnswerTexts = result.correctAnswers.map(letter => {
                        const optionIndex = letter.charCodeAt(0) - 65;
                        return `${letter}. ${question.options[optionIndex]}`;
                    }).join(', ');
                    
                    scoreReportHTML += `
                        <div class="score-report-question">
                            <div class="score-question-header">
                                <span class="score-question-number">Question ${index + 1}</span>
                                <span class="score-result-badge ${result.isCorrect ? 'correct' : 'incorrect'}">
                                    ${result.isCorrect ? 'Correct' : 'Incorrect'}
                                </span>
                            </div>
                            <div class="score-question-text">${question.question}</div>
                            <div class="score-user-answer">
                                <span class="score-label">Your Answer:</span>
                                ${userAnswerTexts}
                            </div>
                            <div class="score-correct-answer">
                                <span class="score-label">Correct Answer:</span>
                                ${correctAnswerTexts}
                            </div>
                            ${question.explanation ? `
                                <div class="score-explanation">
                                    <span class="score-label">Explanation:</span>
                                    ${question.explanation.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: #007bff; text-decoration: underline;">$1</a>')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                scoreReportHTML += `
                        </div>
                    </div>
                `;
                
                scoreReportDiv.innerHTML = scoreReportHTML;
                scoreReportDiv.classList.add('active');
            }

            exportScoreReport() {
                const exportData = {
                    dataset: this.currentDataset,
                    timestamp: new Date().toISOString(),
                    totalQuestions: this.quizResults.length,
                    correctAnswers: this.quizResults.filter(r => r.isCorrect).length,
                    score: Math.round((this.quizResults.filter(r => r.isCorrect).length / this.quizResults.length) * 100),
                    results: this.quizResults.map(result => {
                        // Map letters to full answer text
                        const userAnswerTexts = result.userAnswers.map(letter => {
                            const optionIndex = letter.charCodeAt(0) - 65; // A=0, B=1, etc.
                            return `${letter}. ${result.question.options[optionIndex]}`;
                        });
                        
                        const correctAnswerTexts = result.correctAnswers.map(letter => {
                            const optionIndex = letter.charCodeAt(0) - 65;
                            return `${letter}. ${result.question.options[optionIndex]}`;
                        });
                        
                        return {
                            questionNumber: result.questionIndex + 1,
                            questionId: result.question.id,
                            questionText: result.question.question,
                            userAnswers: userAnswerTexts,
                            correctAnswers: correctAnswerTexts,
                            isCorrect: result.isCorrect,
                            category: result.question.category,
                            explanation: result.question.explanation || null
                        };
                    })
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `quiz-results-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            backToQuizSetup() {
                // Hide score report
                const scoreReport = document.getElementById('scoreReport');
                if (scoreReport) {
                    scoreReport.classList.remove('active');
                }
                
                // Reset quiz data
                this.quizResults = [];
                this.currentQuizQuestions = [];
                this.currentQuizIndex = 0;
                this.quizInProgress = false;
                
                // Show quiz setup
                document.getElementById('quizSetup')?.style?.setProperty?.('display', 'block');
                document.getElementById('quizContainer')?.style?.setProperty?.('display', 'none');
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
        }

        // Initialize the app
        const app = new MCQApp();

        /* Lightbox functionality from script.js */
        (function () {
            const overlay = document.createElement('div');
            overlay.className = 'lb-overlay';
            overlay.innerHTML = `
                <div class="lb-stage">
                    <img class="lb-img" alt="Preview"/>
                    <div class="lb-ui">
                        <button class="lb-btn" data-action="reset" title="Reset (double-click image)">Reset</button>
                        <button class="lb-btn" data-action="close" title="Close (Esc)">Close</button>
                    </div>
                    <div class="lb-caption"></div>
                </div>
            `;
            document.body.appendChild(overlay);

            const stage = overlay.querySelector('.lb-stage');
            const img = overlay.querySelector('.lb-img');
            const caption = overlay.querySelector('.lb-caption');

            let scale = 1;
            let tx = 0;
            let ty = 0;
            let dragging = false;
            let lastX = 0;
            let lastY = 0;

            function applyTransform() {
                img.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
            }

            function openLightbox(url) {
                img.src = url;
                caption.textContent = url;
                scale = 1; tx = 0; ty = 0;
                applyTransform();
                overlay.classList.add('active');
            }
            function closeLightbox() {
                overlay.classList.remove('active');
                img.src = '';
            }
            function resetView() {
                scale = 1; tx = 0; ty = 0; applyTransform();
            }

            stage.addEventListener('wheel', (e) => {
                if (!overlay.classList.contains('active')) return;
                e.preventDefault();
                const rect = img.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                const prevScale = scale;
                const delta = Math.sign(e.deltaY) < 0 ? 0.1 : -0.1;
                scale = Math.min(6, Math.max(0.2, scale + delta));

                tx -= (mouseX / prevScale - mouseX / scale);
                ty -= (mouseY / prevScale - mouseY / scale);

                applyTransform();
            }, { passive: false });

            stage.addEventListener('mousedown', (e) => {
                if (!overlay.classList.contains('active')) return;
                dragging = true;
                lastX = e.clientX;
                lastY = e.clientY;
            });
            window.addEventListener('mousemove', (e) => {
                if (!dragging) return;
                const dx = e.clientX - lastX;
                const dy = e.clientY - lastY;
                lastX = e.clientX;
                lastY = e.clientY;
                tx += dx;
                ty += dy;
                applyTransform();
            });
            window.addEventListener('mouseup', () => dragging = false);

            img.addEventListener('dblclick', (e) => {
                e.preventDefault();
                resetView();
            });

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeLightbox();
            });
            overlay.querySelector('[data-action="close"]').addEventListener('click', closeLightbox);
            overlay.querySelector('[data-action="reset"]').addEventListener('click', resetView);
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('active')) closeLightbox();
            });

            document.addEventListener('click', (e) => {
                const anchor = e.target.closest('.explanation a.lightbox');
                const imgEl = e.target.closest('.explanation img');
                if (!anchor && !imgEl) return;

                let url = null;
                if (anchor) {
                    url = anchor.getAttribute('href');
                } else if (imgEl) {
                    url = imgEl.getAttribute('src');
                    const wrapA = imgEl.closest('a[href]');
                    if (wrapA && wrapA.getAttribute('href')) url = wrapA.getAttribute('href');
                }
                if (!url) return;

                e.preventDefault();
                openLightbox(url);
            });
        })();
    </script>
</body>
</html>