<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Hunt - Best of 2025</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-color: #6366f1;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --border-color: #e5e7eb;
            --border-light: #f3f4f6;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        .top-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            min-height: 3rem;
        }

        .header {
            flex: 1;
            text-align: left;
            margin: 0;
            padding: 0;
        }

        .title {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.01em;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            line-height: 1.2;
        }

        .title i {
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 0.9em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 400;
            margin: 0;
            line-height: 1.2;
        }

        /* Drag and Drop Area */
        .drop-zone {
            border: 1px dashed var(--border-color);
            border-radius: var(--radius-md);
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            transition: all 0.2s ease;
            cursor: pointer;
            flex: 1;
            min-height: 3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .drop-zone:hover,
        .drop-zone.drag-over {
            border-color: var(--accent-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .drop-zone-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .drop-zone i {
            font-size: 1rem;
            color: var(--accent-color);
        }

        .drop-zone-text {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }

        .drop-zone h3 {
            color: var(--text-primary);
            margin: 0;
            font-weight: 500;
            font-size: 0.8rem;
            line-height: 1.2;
        }

        .drop-zone p {
            color: var(--text-secondary);
            font-size: 0.7rem;
            margin: 0;
            line-height: 1.2;
        }

        /* Controls */
        .controls {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: var(--bg-primary);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .clear-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
            display: none;
        }

        .clear-btn:hover {
            color: var(--error-color);
            background: rgba(239, 68, 68, 0.1);
        }

        .multi-tag-container {
            margin-bottom: 1.5rem;
        }

        .filter-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .multi-tag-input-container {
            position: relative;
        }

        .multi-tag-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
        }

        .multi-tag-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: var(--bg-primary);
        }

        .tag-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .tag-suggestion {
            padding: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.875rem;
        }

        .tag-suggestion:hover {
            background: var(--bg-secondary);
        }

        .filter-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .tag-select,
        .sort-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .tag-select:focus,
        .sort-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: var(--bg-primary);
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .clear-all-btn {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .clear-all-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .active-filter {
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent-color);
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .remove-filter {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            padding: 0.125rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .remove-filter:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .stat-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Table */
        .table-container {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
        }

        .products-table th {
            background: var(--bg-tertiary);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .sortable {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .sortable:hover {
            background: var(--bg-secondary);
        }

        .sort-icon {
            margin-left: 0.5rem;
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .products-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
            vertical-align: top;
        }

        .products-table tr:hover {
            background: var(--bg-secondary);
        }

        .product-name {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
        }

        .product-name:hover {
            color: #4f46e5;
            text-decoration: underline;
        }

        .product-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            max-width: 300px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .metric-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .metric-value.upvotes {
            color: var(--success-color);
        }

        .metric-value.comments {
            color: var(--accent-color);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            max-width: 200px;
        }

        .tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent-color);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .tag:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-1px);
        }

        .visit-btn {
            background: var(--accent-color);
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .visit-btn:hover {
            background: #4f46e5;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Loading and No Results */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .no-results i {
            font-size: 3rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .no-results h3 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .top-row {
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
            }

            .header {
                text-align: center;
            }

            .file-selection {
                order: 3; /* Move file selection after drop zone on mobile */
            }

            .drop-zone {
                order: 2;
            }

            .error-container {
                order: 4;
            }

            .filter-container {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .products-table th,
            .products-table td {
                padding: 0.75rem 0.5rem;
            }

            .tags-container {
                max-width: 150px;
            }

            .product-description {
                max-width: 200px;
                -webkit-line-clamp: 1;
            }
        }

        /* Animations */
        .table-row-fade-in {
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* File Upload Styling */
        .file-upload-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .current-file {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Error styling */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin: 1rem 0;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Top Row: Header, File Selection, Drop Zone, and Error Area -->
        <div class="top-row">
            <!-- Header -->
            <header class="header">
                <h1 class="title">
                    <i class="fas fa-rocket"></i>
                    Product Hunt 2025
                </h1>
                <p class="subtitle">Data viewer</p>
            </header>

            <!-- File Selection Menu -->
            <div class="file-selection">
                <select id="fileSelect" class="file-select" title="Select a JSON file to load">
                    <option value="">Scanning for files...</option>
                    <option value="products.json">products.json (default)</option>
                </select>
                <div class="file-controls">
                    <button id="refreshFiles" class="refresh-btn" title="Refresh file list">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="addCustomFile" class="add-file-btn" title="Add custom filename">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button id="helpBtn" class="refresh-btn" style="background: var(--text-muted);" title="Show help">
                        <i class="fas fa-question"></i>
                    </button>
                </div>
                <div class="file-count" id="fileCount"></div>
            </div>

            <!-- Drag and Drop Zone -->
            <div class="drop-zone" id="dropZone">
                <input type="file" accept=".json" class="file-upload-input" id="fileInput">
                <div class="drop-zone-content">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <div class="drop-zone-text">
                        <h3>Drop JSON or click</h3>
                        <p>Load custom data</p>
                    </div>
                </div>
                <div class="current-file" id="currentFile" style="display: none;">
                    <i class="fas fa-file-alt"></i>
                    <span id="fileName">products.json</span>
                </div>
            </div>

            <!-- Error Area -->
            <div class="error-container" id="errorContainer"></div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search products by name or description..."
                    class="search-input"
                >
                <button id="clearSearch" class="clear-btn" title="Clear search">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="multi-tag-container">
                <label for="multiTagSearch" class="filter-label">
                    <i class="fas fa-tags"></i>
                    Search Multiple Tags (comma-separated):
                </label>
                <div class="multi-tag-input-container">
                    <input 
                        type="text" 
                        id="multiTagSearch" 
                        placeholder="e.g. AI, Productivity, SaaS"
                        class="multi-tag-input"
                    >
                    <div class="tag-suggestions" id="tagSuggestions"></div>
                </div>
            </div>
            
            <div class="filter-container">
                <div class="filter-group">
                    <label for="tagFilter" class="filter-label">
                        <i class="fas fa-tag"></i>
                        Filter by Single Tag:
                    </label>
                    <select id="tagFilter" class="tag-select">
                        <option value="">All Tags</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sortBy" class="filter-label">
                        <i class="fas fa-sort"></i>
                        Sort by:
                    </label>
                    <select id="sortBy" class="sort-select">
                        <option value="upvotes-desc">Most Upvotes</option>
                        <option value="upvotes-asc">Least Upvotes</option>
                        <option value="comments-desc">Most Comments</option>
                        <option value="comments-asc">Least Comments</option>
                        <option value="name-asc">Name A-Z</option>
                        <option value="name-desc">Name Z-A</option>
                    </select>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="clearAllFilters" class="clear-all-btn">
                    <i class="fas fa-broom"></i>
                    Clear All Filters
                </button>
                <div class="active-filters" id="activeFilters"></div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-item">
                <span class="stat-number" id="totalProducts">0</span>
                <span class="stat-label">Total Products</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="filteredProducts">0</span>
                <span class="stat-label">Showing</span>
            </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div class="table-wrapper">
                <table class="products-table" id="productsTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="name">
                                Product Name
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="description-col">Description</th>
                            <th class="sortable" data-sort="upvotes">
                                <i class="fas fa-arrow-up"></i>
                                Upvotes
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="comments">
                                <i class="fas fa-comment"></i>
                                Comments
                                <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="tags-col">Tags</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <!-- Products will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Loading products...</p>
        </div>

        <!-- No Results State -->
        <div class="no-results" id="noResults" style="display: none;">
            <i class="fas fa-search"></i>
            <h3>No products found</h3>
            <p>Try adjusting your search or filter criteria</p>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 Product Hunt Data Viewer. Data sourced from Product Hunt.</p>
        </footer>

        <!-- Add Custom File Modal -->
        <div class="modal-overlay" id="addFileModal" style="display: none;">
            <div class="modal">
                <h3>Add Custom JSON File</h3>
                <input type="text" id="customFileName" placeholder="Enter filename (e.g., mydata.json)" />
                <p style="font-size: 0.75rem; color: var(--text-secondary); margin: 0 0 1rem 0;">
                    Enter just the filename. It will be loaded from the json/ folder.
                </p>
                <div class="modal-buttons">
                    <button class="modal-btn secondary" onclick="closeAddFileModal()">Cancel</button>
                    <button class="modal-btn primary" onclick="addCustomFile()">Add File</button>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal-overlay" id="helpModal" style="display: none;">
            <div class="modal" style="max-width: 600px;">
                <h3>How File Detection Works</h3>
                <div style="font-size: 0.875rem; line-height: 1.5; color: var(--text-primary);">
                    <p><strong>📁 Local Testing (Python webserver):</strong></p>
                    <ol style="margin: 0.5rem 0 1rem 1.5rem;">
                        <li>Create a <code>json/</code> folder next to this HTML file</li>
                        <li>Put your .json files in that folder (any filename works!)</li>
                        <li>Run <code>python -m http.server 8000</code></li>
                        <li>The app will automatically read the folder contents</li>
                    </ol>
                    
                    <p><strong>🔍 Detection Methods:</strong></p>
                    <ul style="margin: 0.5rem 0 1rem 1.5rem;">
                        <li>🗂️ <strong>Directory Listing:</strong> Reads actual folder (local servers)</li>
                        <li>📋 <strong>Index File:</strong> Uses json/index.json</li>
                        <li>📁 <strong>Pattern Scan:</strong> Tests common filenames</li>
                        <li>✏️ <strong>Manual Add:</strong> Click + to add specific names</li>
                    </ul>
                    
                    <p><strong>💡 Tips:</strong></p>
                    <ul style="margin: 0.5rem 0 1rem 1.5rem;">
                        <li>Name files descriptively: data.json, products-2024.json</li>
                        <li>Click refresh (🔄) after adding new files</li>
                        <li>Check browser console for detailed scanning logs</li>
                        <li>Use + button if auto-detection misses files</li>
                    </ul>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn primary" onclick="closeHelpModal()">Got it!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let allProducts = [];
        let filteredProducts = [];
        let currentSort = { field: 'upvotes', direction: 'desc' };
        let allTags = [];
        let activeFilters = {
            search: '',
            singleTag: '',
            multiTags: [],
            sort: 'upvotes-desc'
        };
        let currentFileName = 'products.json (default)';

        // DOM elements
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearch');
        const tagFilter = document.getElementById('tagFilter');
        const sortBy = document.getElementById('sortBy');
        const multiTagSearch = document.getElementById('multiTagSearch');
        const clearAllFiltersBtn = document.getElementById('clearAllFilters');
        const activeFiltersContainer = document.getElementById('activeFilters');
        const tagSuggestions = document.getElementById('tagSuggestions');
        const productsTableBody = document.getElementById('productsTableBody');
        const totalProductsSpan = document.getElementById('totalProducts');
        const filteredProductsSpan = document.getElementById('filteredProducts');
        const loading = document.getElementById('loading');
        const noResults = document.getElementById('noResults');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const currentFileDiv = document.getElementById('currentFile');
        const fileNameSpan = document.getElementById('fileName');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableFiles();
            loadProducts();
            setupEventListeners();
            setupDragAndDrop();
        });

        // Load available files from json/ folder
        async function loadAvailableFiles() {
            availableFiles = [];
            
            // First, try to get directory listing (works with local servers like Python's http.server)
            const foundViaListing = await tryDirectoryListing();
            
            if (!foundViaListing) {
                console.log('Directory listing not available, trying index.json...');
                
                // Try to load index.json if it exists
                try {
                    const indexResponse = await fetch('json/index.json');
                    if (indexResponse.ok) {
                        const fileIndex = await indexResponse.json();
                        const indexedFiles = fileIndex.files || [];
                        
                        // Verify each file in the index actually exists
                        for (const file of indexedFiles) {
                            try {
                                const testResponse = await fetch(`json/${file.filename}`, { method: 'HEAD' });
                                if (testResponse.ok) {
                                    availableFiles.push({
                                        filename: file.filename,
                                        name: file.name || file.filename,
                                        description: file.description || '',
                                        source: 'index'
                                    });
                                }
                            } catch (e) {
                                console.log(`File ${file.filename} listed in index but not accessible`);
                            }
                        }
                        
                        console.log(`Found ${availableFiles.length} files from index.json`);
                    }
                } catch (error) {
                    console.log('No index.json found, scanning for files...');
                }
                
                // If we still don't have many files, try pattern scanning
                if (availableFiles.length < 5) {
                    await scanForJsonFiles();
                }
            }
            
            // Populate the dropdown with found files
            populateFileSelect();
        }

        // Try to get directory listing from the server
        async function tryDirectoryListing() {
            try {
                console.log('Attempting to read directory listing...');
                const response = await fetch('json/', {
                    headers: {
                        'Accept': 'text/html,application/xhtml+xml'
                    }
                });
                
                if (response.ok) {
                    const html = await response.text();
                    const jsonFiles = parseDirectoryListing(html);
                    
                    if (jsonFiles.length > 0) {
                        console.log(`Found ${jsonFiles.length} JSON files via directory listing:`, jsonFiles);
                        
                        for (const filename of jsonFiles) {
                            availableFiles.push({
                                filename: filename,
                                name: filename.replace('.json', '').replace(/[-_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                                description: 'Found via directory listing',
                                source: 'listing'
                            });
                        }
                        
                        return true;
                    }
                }
            } catch (error) {
                console.log('Directory listing not available:', error.message);
            }
            
            return false;
        }

        // Parse directory listing HTML to extract .json files
        function parseDirectoryListing(html) {
            const jsonFiles = [];
            
            // Try different directory listing formats
            
            // Python http.server format
            const pythonMatches = html.match(/<a href="([^"]+\.json)"/gi);
            if (pythonMatches) {
                pythonMatches.forEach(match => {
                    const filename = match.match(/href="([^"]+)"/i)[1];
                    if (filename.endsWith('.json') && !filename.includes('/')) {
                        jsonFiles.push(filename);
                    }
                });
            }
            
            // Apache/Nginx directory listing format
            const apacheMatches = html.match(/href="([^"]*\.json)"/gi);
            if (apacheMatches && jsonFiles.length === 0) {
                apacheMatches.forEach(match => {
                    const filename = match.match(/href="([^"]+)"/i)[1];
                    if (filename.endsWith('.json') && !filename.includes('/')) {
                        jsonFiles.push(filename);
                    }
                });
            }
            
            // Look for any .json references in the HTML
            if (jsonFiles.length === 0) {
                const allMatches = html.match(/[\w\-\.]+\.json/gi);
                if (allMatches) {
                    allMatches.forEach(filename => {
                        if (!jsonFiles.includes(filename)) {
                            jsonFiles.push(filename);
                        }
                    });
                }
            }
            
            // Remove duplicates and filter
            return [...new Set(jsonFiles)].filter(f => 
                f.endsWith('.json') && 
                !f.includes('..') && 
                f.length > 5 && 
                f.length < 100
            );
        }

        // Scan for JSON files using comprehensive patterns
        async function scanForJsonFiles() {
            const commonPatterns = [
                // Very common names
                'data', 'products', 'items', 'list', 'export', 'dataset', 'file', 'content',
                'sample', 'demo', 'test', 'backup', 'archive', 'temp', 'tmp',
                
                // Year patterns
                '2024', '2025', '2023', '2022', '2021', 'latest', 'current', 'new', 'old',
                'data-2024', 'data-2025', 'products-2024', 'products-2025',
                
                // Type patterns
                'apps', 'tools', 'software', 'services', 'startups', 'companies',
                'saas', 'mobile', 'web', 'ai', 'tech', 'api', 'database', 'db',
                
                // Category patterns
                'featured', 'popular', 'trending', 'top', 'best', 'new', 'hot',
                'winners', 'makers', 'hunters', 'launch', 'launches',
                
                // Monthly patterns
                'january', 'february', 'march', 'april', 'may', 'june',
                'july', 'august', 'september', 'october', 'november', 'december',
                'jan', 'feb', 'mar', 'apr', 'may', 'jun',
                'jul', 'aug', 'sep', 'oct', 'nov', 'dec',
                
                // Quarterly patterns
                'q1', 'q2', 'q3', 'q4', 'quarter1', 'quarter2', 'quarter3', 'quarter4',
                
                // Common user patterns
                'my-data', 'mydata', 'user-data', 'userdata', 'personal', 'custom',
                'import', 'imported', 'download', 'downloaded', 'export', 'exported',
                
                // Generic patterns
                'output', 'result', 'results', 'report', 'reports', 'summary',
                'collection', 'catalog', 'inventory', 'feed', 'dump'
            ];
            
            const separators = ['', '-', '_'];
            const yearSuffixes = ['', '-2024', '-2025', '-2023', '_2024', '_2025', '_2023'];
            const numberSuffixes = ['', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
            
            const filesToTry = new Set();
            
            // Generate combinations of patterns
            commonPatterns.forEach(pattern => {
                separators.forEach(sep => {
                    yearSuffixes.forEach(year => {
                        numberSuffixes.forEach(num => {
                            if (sep === '' && year === '' && num === '') {
                                filesToTry.add(`${pattern}.json`);
                            } else {
                                filesToTry.add(`${pattern}${sep}${year}${num}.json`);
                            }
                        });
                    });
                });
            });
            
            // Add simple patterns
            for (let i = 1; i <= 50; i++) {
                filesToTry.add(`${i}.json`);
                filesToTry.add(`file${i}.json`);
                filesToTry.add(`data${i}.json`);
                filesToTry.add(`dataset${i}.json`);
                filesToTry.add(`products${i}.json`);
                filesToTry.add(`list${i}.json`);
            }
            
            // Add alphabetical patterns
            for (let i = 97; i <= 122; i++) { // a-z
                const letter = String.fromCharCode(i);
                filesToTry.add(`${letter}.json`);
                filesToTry.add(`data-${letter}.json`);
                filesToTry.add(`file-${letter}.json`);
            }
            
            // Add date patterns
            const currentYear = new Date().getFullYear();
            for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                for (let month = 1; month <= 12; month++) {
                    const monthStr = month.toString().padStart(2, '0');
                    filesToTry.add(`${year}-${monthStr}.json`);
                    filesToTry.add(`data-${year}-${monthStr}.json`);
                    filesToTry.add(`products-${year}-${monthStr}.json`);
                }
            }
            
            console.log(`Scanning ${filesToTry.size} potential filenames...`);
            
            // Test files in smaller batches with progress updates
            const batchSize = 20;
            const fileArray = Array.from(filesToTry);
            let foundCount = 0;
            
            for (let i = 0; i < fileArray.length; i += batchSize) {
                const batch = fileArray.slice(i, i + batchSize);
                const progress = Math.round((i / fileArray.length) * 100);
                
                // Update UI with progress
                fileCountDiv.textContent = `Scanning... ${progress}% (${foundCount} found)`;
                
                const batchPromises = batch.map(filename => testFileExists(filename));
                const results = await Promise.allSettled(batchPromises);
                
                results.forEach((result, index) => {
                    if (result.status === 'fulfilled' && result.value) {
                        const filename = batch[index];
                        // Check if we already have this file
                        const alreadyExists = availableFiles.some(f => f.filename === filename);
                        if (!alreadyExists) {
                            availableFiles.push({
                                filename: filename,
                                name: filename.replace('.json', '').replace(/[-_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                                description: 'Auto-detected file',
                                source: 'scan'
                            });
                            foundCount++;
                        }
                    }
                });
                
                // Small delay between batches and update UI
                if (i + batchSize < fileArray.length) {
                    await new Promise(resolve => setTimeout(resolve, 50));
                    // Update dropdown periodically so user sees progress
                    if (foundCount > 0 && i % (batchSize * 10) === 0) {
                        populateFileSelect();
                    }
                }
            }
            
            console.log(`Found ${foundCount} files via pattern scanning`);
        }

        // Test if a specific file exists
        async function testFileExists(filename) {
            try {
                const response = await fetch(`json/${filename}`, { 
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                if (response.ok) {
                    console.log(`✓ Found: json/${filename}`);
                    return true;
                }
                return false;
            } catch (error) {
                return false;
            }
        }

        // Populate the file selection dropdown
        function populateFileSelect() {
            // Clear existing options except default
            fileSelect.innerHTML = `
                <option value="">Select JSON file...</option>
                <option value="products.json">products.json (default)</option>
            `;
            
            // Sort files by name
            const sortedFiles = [...availableFiles].sort((a, b) => a.name.localeCompare(b.name));
            
            // Add files from json/ folder
            sortedFiles.forEach(file => {
                const option = document.createElement('option');
                option.value = `json/${file.filename}`;
                
                // Create display name with source indicator
                let displayName = file.name;
                if (file.source === 'scan') {
                    displayName += ' 📁';
                } else if (file.source === 'index') {
                    displayName += ' 📋';
                } else if (file.source === 'custom') {
                    displayName += ' ✏️';
                } else if (file.source === 'listing') {
                    displayName += ' 🗂️';
                }
                
                option.textContent = displayName;
                
                if (file.description) {
                    option.title = file.description;
                }
                fileSelect.appendChild(option);
            });
            
            // Update file count
            updateFileCount();
            
            // Enable controls
            refreshFilesBtn.disabled = false;
            addCustomFileBtn.disabled = false;
        }

        // Update file count display
        function updateFileCount() {
            const total = availableFiles.length;
            if (total > 0) {
                const listing = availableFiles.filter(f => f.source === 'listing').length;
                const scanned = availableFiles.filter(f => f.source === 'scan').length;
                const indexed = availableFiles.filter(f => f.source === 'index').length;
                const custom = availableFiles.filter(f => f.source === 'custom').length;
                
                let countText = `${total} file${total !== 1 ? 's' : ''}`;
                if (listing > 0 || scanned > 0 || indexed > 0 || custom > 0) {
                    const sources = [];
                    if (listing > 0) sources.push(`${listing} listed`);
                    if (indexed > 0) sources.push(`${indexed} indexed`);
                    if (scanned > 0) sources.push(`${scanned} found`);
                    if (custom > 0) sources.push(`${custom} custom`);
                    countText += ` (${sources.join(', ')})`;
                }
                
                fileCountDiv.textContent = countText;
            } else {
                fileCountDiv.textContent = 'No files found';
            }
        }

        // Handle file selection from dropdown
        async function handleFileSelection() {
            const selectedFile = fileSelect.value;
            if (!selectedFile) return;
            
            try {
                showLoading();
                hideError();
                
                const response = await fetch(selectedFile);
                if (!response.ok) {
                    throw new Error(`Failed to load ${selectedFile}`);
                }
                
                const jsonData = await response.json();
                
                if (validateProductData(jsonData)) {
                    allProducts = jsonData;
                    filteredProducts = [...allProducts];
                    
                    // Update filename display
                    currentFileName = selectedFile.split('/').pop();
                    
                    // Update UI
                    populateTagFilter();
                    updateStats();
                    renderTable();
                    hideLoading();
                    showCurrentFile();
                    
                } else {
                    throw new Error('Invalid JSON format. Expected array of products with required properties.');
                }
                
            } catch (error) {
                console.error('Error loading selected file:', error);
                showError(`Failed to load ${selectedFile}: ${error.message}`);
                hideLoading();
                // Reset selection to show error
                fileSelect.value = '';
            }
        }

        // Refresh the file list
        async function refreshFileList() {
            refreshFilesBtn.disabled = true;
            addCustomFileBtn.disabled = true;
            refreshFilesBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            // Update select to show scanning status
            fileSelect.innerHTML = '<option value="">Scanning for files...</option>';
            fileCountDiv.textContent = 'Scanning...';
            
            try {
                await loadAvailableFiles();
                showSuccessMessage(`Found ${availableFiles.length} files`);
            } catch (error) {
                showError('Failed to refresh file list');
            } finally {
                refreshFilesBtn.disabled = false;
                addCustomFileBtn.disabled = false;
                refreshFilesBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
            }
        }

        // Modal functions
        function openAddFileModal() {
            addFileModal.style.display = 'flex';
            customFileNameInput.value = '';
            customFileNameInput.focus();
        }

        function closeAddFileModal() {
            addFileModal.style.display = 'none';
        }

        function openHelpModal() {
            helpModal.style.display = 'flex';
        }

        function closeHelpModal() {
            helpModal.style.display = 'none';
        }

        async function addCustomFile() {
            const filename = customFileNameInput.value.trim();
            if (!filename) return;
            
            // Ensure .json extension
            const jsonFilename = filename.endsWith('.json') ? filename : filename + '.json';
            
            // Check if file already exists in list
            const exists = availableFiles.some(f => f.filename === jsonFilename);
            if (exists) {
                showError('File already in list');
                return;
            }
            
            // Test if file exists
            const fileExists = await testFileExists(jsonFilename);
            if (!fileExists) {
                showError(`File json/${jsonFilename} not found`);
                return;
            }
            
            // Add to available files
            availableFiles.push({
                filename: jsonFilename,
                name: jsonFilename.replace('.json', '').replace(/[-_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                description: 'Custom added file',
                source: 'custom'
            });
            
            // Update UI
            populateFileSelect();
            closeAddFileModal();
            showSuccessMessage(`Added ${jsonFilename}`);
            
            // Auto-select the new file
            fileSelect.value = `json/${jsonFilename}`;
            handleFileSelection();
        }

        // Handle Enter key in modals
        document.addEventListener('keydown', function(e) {
            if (addFileModal.style.display === 'flex') {
                if (e.key === 'Enter') {
                    addCustomFile();
                } else if (e.key === 'Escape') {
                    closeAddFileModal();
                }
            } else if (helpModal.style.display === 'flex') {
                if (e.key === 'Escape') {
                    closeHelpModal();
                }
            }
        });

        // Show success message briefly
        function showSuccessMessage(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `
                <div style="background: rgba(16, 185, 129, 0.1); color: var(--success-color); padding: 0.5rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.2); font-size: 0.75rem; width: 100%; text-align: center;">
                    <i class="fas fa-check" style="margin-right: 0.25rem;"></i>
                    ${message}
                </div>
            `;
            
            // Clear success message after 3 seconds
            setTimeout(() => {
                hideError();
            }, 3000);
        }
        function setupDragAndDrop() {
            // File input change
            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop events
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);

            // Click to browse
            dropZone.addEventListener('click', (e) => {
                if (e.target === fileInput) return;
                fileInput.click();
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            if (!dropZone.contains(e.relatedTarget)) {
                dropZone.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type === 'application/json' || file.name.endsWith('.json')) {
                    loadCustomFile(file);
                } else {
                    showError('Please drop a valid JSON file.');
                }
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                loadCustomFile(file);
            }
        }

        function loadCustomFile(file) {
            const reader = new FileReader();
            
            showLoading();
            currentFileName = file.name;
            
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    // Validate JSON structure
                    if (validateProductData(jsonData)) {
                        allProducts = jsonData;
                        filteredProducts = [...allProducts];
                        
                        // Update UI
                        populateTagFilter();
                        updateStats();
                        renderTable();
                        hideLoading();
                        showCurrentFile();
                        
                        // Clear any previous errors
                        hideError();
                        
                    } else {
                        throw new Error('Invalid JSON format. Expected array of products with name, description, upvotes, comments, tags, and url properties.');
                    }
                    
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                    showError(`Error loading file: ${error.message}`);
                    hideLoading();
                }
            };
            
            reader.onerror = function() {
                showError('Error reading file. Please try again.');
                hideLoading();
            };
            
            reader.readAsText(file);
        }

        function validateProductData(data) {
            if (!Array.isArray(data)) {
                return false;
            }
            
            if (data.length === 0) {
                return true; // Empty array is valid
            }
            
            // Check first few items for required properties
            const sampleSize = Math.min(5, data.length);
            for (let i = 0; i < sampleSize; i++) {
                const item = data[i];
                if (!item || typeof item !== 'object') {
                    return false;
                }
                
                // Check required properties
                const requiredProps = ['name', 'description', 'upvotes', 'comments', 'tags', 'url'];
                for (let prop of requiredProps) {
                    if (!(prop in item)) {
                        return false;
                    }
                }
                
                // Validate property types
                if (typeof item.name !== 'string' ||
                    typeof item.description !== 'string' ||
                    typeof item.upvotes !== 'number' ||
                    typeof item.comments !== 'number' ||
                    !Array.isArray(item.tags) ||
                    typeof item.url !== 'string') {
                    return false;
                }
            }
            
            return true;
        }

        function showCurrentFile() {
            fileNameSpan.textContent = currentFileName;
            currentFileDiv.style.display = 'inline-flex';
        }

        function showLoading() {
            loading.style.display = 'block';
            document.querySelector('.table-container').style.display = 'none';
            noResults.style.display = 'none';
        }

        // Load products from JSON file (default behavior)
        async function loadProducts() {
            try {
                showLoading();
                const response = await fetch('products.json');
                if (!response.ok) {
                    throw new Error('Failed to load products data');
                }
                
                allProducts = await response.json();
                filteredProducts = [...allProducts];
                
                // Initialize UI
                populateTagFilter();
                updateStats();
                renderTable();
                hideLoading();
                showCurrentFile();
                
            } catch (error) {
                console.error('Error loading products:', error);
                showError('Failed to load default products data. You can drag and drop a JSON file to load custom data.');
                hideLoading();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            searchInput.addEventListener('input', debounce(handleSearch, 300));
            clearSearchBtn.addEventListener('click', clearSearch);
            
            // Multi-tag search functionality
            multiTagSearch.addEventListener('input', debounce(handleMultiTagSearch, 300));
            multiTagSearch.addEventListener('focus', showTagSuggestions);
            multiTagSearch.addEventListener('blur', hideTagSuggestions);
            
            // Filter functionality
            tagFilter.addEventListener('change', handleTagFilter);
            sortBy.addEventListener('change', handleSort);
            
            // File selection functionality
            fileSelect.addEventListener('change', handleFileSelection);
            refreshFilesBtn.addEventListener('click', refreshFileList);
            addCustomFileBtn.addEventListener('click', openAddFileModal);
            helpBtn.addEventListener('click', openHelpModal);
            
            // Clear all filters
            clearAllFiltersBtn.addEventListener('click', clearAllFilters);
            
            // Table header sorting
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', () => {
                    const sortField = header.dataset.sort;
                    handleTableSort(sortField);
                });
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Click outside to hide suggestions
            document.addEventListener('click', (e) => {
                if (!multiTagSearch.contains(e.target) && !tagSuggestions.contains(e.target)) {
                    hideTagSuggestions();
                }
            });
        }

        // Handle search functionality
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                clearSearchBtn.style.display = 'none';
            } else {
                clearSearchBtn.style.display = 'block';
            }
            
            applyFilters();
        }

        // Clear search
        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.style.display = 'none';
            applyFilters();
        }

        // Handle tag filtering
        function handleTagFilter() {
            applyFilters();
        }

        // Handle sorting
        function handleSort() {
            const sortValue = sortBy.value;
            const [field, direction] = sortValue.split('-');
            
            currentSort = { field, direction };
            sortProducts();
            renderTable();
        }

        // Handle table header sorting
        function handleTableSort(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'desc';
            }
            
            // Update sort dropdown to match
            const sortValue = `${currentSort.field}-${currentSort.direction}`;
            sortBy.value = sortValue;
            
            sortProducts();
            renderTable();
            updateSortIcons();
        }

        // Apply all filters
        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedTag = tagFilter.value;
            const multiTagsInput = multiTagSearch.value.toLowerCase().trim();
            
            // Parse multi-tags (comma-separated)
            const multiTags = multiTagsInput ? 
                multiTagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : [];
            
            // Update active filters
            activeFilters.search = searchTerm;
            activeFilters.singleTag = selectedTag;
            activeFilters.multiTags = multiTags;
            
            filteredProducts = allProducts.filter(product => {
                // Search filter
                const matchesSearch = searchTerm === '' || 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm);
                
                // Single tag filter
                const matchesSingleTag = selectedTag === '' || 
                    product.tags.some(tag => tag.toLowerCase() === selectedTag.toLowerCase());
                
                // Multi-tag filter (all specified tags must be present)
                const matchesMultiTags = multiTags.length === 0 || 
                    multiTags.every(searchTag => 
                        product.tags.some(productTag => 
                            productTag.toLowerCase().includes(searchTag)
                        )
                    );
                
                return matchesSearch && matchesSingleTag && matchesMultiTags;
            });
            
            sortProducts();
            updateStats();
            renderTable();
            updateActiveFiltersDisplay();
        }

        // Sort products based on current sort settings
        function sortProducts() {
            filteredProducts.sort((a, b) => {
                let aValue = a[currentSort.field];
                let bValue = b[currentSort.field];
                
                // Handle string sorting
                if (typeof aValue === 'string') {
                    aValue = aValue.toLowerCase();
                    bValue = bValue.toLowerCase();
                }
                
                // Handle numeric sorting
                if (typeof aValue === 'number') {
                    return currentSort.direction === 'asc' ? aValue - bValue : bValue - aValue;
                }
                
                // Handle string sorting
                if (currentSort.direction === 'asc') {
                    return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
                } else {
                    return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
                }
            });
        }

        // Update statistics
        function updateStats() {
            totalProductsSpan.textContent = allProducts.length.toLocaleString();
            filteredProductsSpan.textContent = filteredProducts.length.toLocaleString();
            
            // Animate numbers
            animateNumber(totalProductsSpan, allProducts.length);
            animateNumber(filteredProductsSpan, filteredProducts.length);
        }

        // Animate number counting
        function animateNumber(element, targetNumber) {
            const startNumber = 0;
            const duration = 1000;
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentNumber = Math.floor(startNumber + (targetNumber - startNumber) * progress);
                element.textContent = currentNumber.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        // Render the products table
        function renderTable() {
            if (filteredProducts.length === 0) {
                showNoResults();
                return;
            }
            
            hideNoResults();
            
            const tbody = productsTableBody;
            tbody.innerHTML = '';
            
            filteredProducts.forEach((product, index) => {
                const row = createProductRow(product, index);
                tbody.appendChild(row);
            });
            
            // Add fade-in animation
            tbody.style.opacity = '0';
            setTimeout(() => {
                tbody.style.transition = 'opacity 0.3s ease';
                tbody.style.opacity = '1';
            }, 50);
        }

        // Create a product row
        function createProductRow(product, index) {
            const row = document.createElement('tr');
            row.style.animationDelay = `${index * 0.05}s`;
            row.className = 'table-row-fade-in';
            
            row.innerHTML = `
                <td>
                    <a href="${product.url}" target="_blank" class="product-name" title="${escapeHtml(product.name)}">
                        ${escapeHtml(product.name)}
                    </a>
                </td>
                <td>
                    <div class="product-description" title="${escapeHtml(product.description)}">
                        ${escapeHtml(product.description) || 'No description available'}
                    </div>
                </td>
                <td>
                    <div class="metric-value upvotes">
                        <i class="fas fa-arrow-up"></i>
                        ${product.upvotes.toLocaleString()}
                    </div>
                </td>
                <td>
                    <div class="metric-value comments">
                        <i class="fas fa-comment"></i>
                        ${product.comments.toLocaleString()}
                    </div>
                </td>
                <td>
                    <div class="tags-container">
                        ${product.tags.map(tag => 
                            `<span class="tag" onclick="filterByTag('${escapeHtml(tag)}')" title="Filter by ${escapeHtml(tag)}">${escapeHtml(tag)}</span>`
                        ).join('')}
                    </div>
                </td>
                <td>
                    <a href="${product.url}" target="_blank" class="visit-btn" title="Visit ${escapeHtml(product.name)}">
                        <i class="fas fa-external-link-alt"></i>
                        Visit
                    </a>
                </td>
            `;
            
            return row;
        }

        // Filter by tag when tag is clicked
        function filterByTag(tag) {
            tagFilter.value = tag;
            applyFilters();
            
            // Scroll to top of table
            document.querySelector('.table-container').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Update sort icons in table headers
        function updateSortIcons() {
            document.querySelectorAll('.sortable .sort-icon').forEach(icon => {
                icon.className = 'fas fa-sort sort-icon';
            });
            
            const activeHeader = document.querySelector(`[data-sort="${currentSort.field}"] .sort-icon`);
            if (activeHeader) {
                activeHeader.className = `fas fa-sort-${currentSort.direction === 'asc' ? 'up' : 'down'} sort-icon`;
            }
        }

        // Handle keyboard shortcuts
        function handleKeyboardShortcuts(event) {
            // Ctrl/Cmd + K to focus search
            if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                event.preventDefault();
                searchInput.focus();
            }
            
            // Escape to clear search
            if (event.key === 'Escape' && document.activeElement === searchInput) {
                clearSearch();
                searchInput.blur();
            }
        }

        // Handle multi-tag search
        function handleMultiTagSearch() {
            applyFilters();
        }

        // Clear all filters
        function clearAllFilters() {
            // Reset all inputs
            searchInput.value = '';
            multiTagSearch.value = '';
            tagFilter.value = '';
            sortBy.value = 'upvotes-desc';
            
            // Reset active filters
            activeFilters = {
                search: '',
                singleTag: '',
                multiTags: [],
                sort: 'upvotes-desc'
            };
            
            // Reset sort
            currentSort = { field: 'upvotes', direction: 'desc' };
            
            // Hide clear search button
            clearSearchBtn.style.display = 'none';
            
            // Apply filters (which will show all products)
            applyFilters();
            
            // Add visual feedback
            clearAllFiltersBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                clearAllFiltersBtn.style.transform = 'scale(1)';
            }, 150);
        }

        // Show tag suggestions
        function showTagSuggestions() {
            const input = multiTagSearch.value.toLowerCase();
            const currentTags = input.split(',').map(tag => tag.trim());
            const lastTag = currentTags[currentTags.length - 1];
            
            if (lastTag.length > 0) {
                const suggestions = allTags.filter(tag => 
                    tag.toLowerCase().includes(lastTag) && 
                    !currentTags.slice(0, -1).some(existingTag => 
                        existingTag.toLowerCase() === tag.toLowerCase()
                    )
                ).slice(0, 10);
                
                if (suggestions.length > 0) {
                    tagSuggestions.innerHTML = suggestions.map(tag => 
                        `<div class="tag-suggestion" onclick="selectTagSuggestion('${escapeHtml(tag)}')">${escapeHtml(tag)}</div>`
                    ).join('');
                    tagSuggestions.style.display = 'block';
                } else {
                    hideTagSuggestions();
                }
            } else {
                hideTagSuggestions();
            }
        }

        // Hide tag suggestions
        function hideTagSuggestions() {
            setTimeout(() => {
                tagSuggestions.style.display = 'none';
            }, 200);
        }

        // Select tag suggestion
        function selectTagSuggestion(tag) {
            const currentValue = multiTagSearch.value;
            const tags = currentValue.split(',').map(t => t.trim());
            tags[tags.length - 1] = tag;
            multiTagSearch.value = tags.join(', ') + ', ';
            hideTagSuggestions();
            multiTagSearch.focus();
            applyFilters();
        }

        // Update active filters display
        function updateActiveFiltersDisplay() {
            const container = activeFiltersContainer;
            container.innerHTML = '';
            
            // Search filter
            if (activeFilters.search) {
                container.appendChild(createActiveFilterTag('Search', activeFilters.search, 'search'));
            }
            
            // Single tag filter
            if (activeFilters.singleTag) {
                container.appendChild(createActiveFilterTag('Tag', activeFilters.singleTag, 'singleTag'));
            }
            
            // Multi-tag filters
            activeFilters.multiTags.forEach((tag, index) => {
                container.appendChild(createActiveFilterTag('Multi-Tag', tag, 'multiTag', index));
            });
            
            // Sort filter (only show if not default)
            if (activeFilters.sort !== 'upvotes-desc') {
                const sortLabel = sortBy.options[sortBy.selectedIndex].text;
                container.appendChild(createActiveFilterTag('Sort', sortLabel, 'sort'));
            }
        }

        // Create active filter tag element
        function createActiveFilterTag(type, value, filterType, index = null) {
            const tag = document.createElement('div');
            tag.className = 'active-filter';
            tag.innerHTML = `
                <span>${type}: ${escapeHtml(value)}</span>
                <button class="remove-filter" onclick="removeActiveFilter('${filterType}', ${index})" title="Remove filter">
                    <i class="fas fa-times"></i>
                </button>
            `;
            return tag;
        }

        // Remove active filter
        function removeActiveFilter(filterType, index = null) {
            switch (filterType) {
                case 'search':
                    searchInput.value = '';
                    clearSearch();
                    break;
                case 'singleTag':
                    tagFilter.value = '';
                    handleTagFilter();
                    break;
                case 'multiTag':
                    const currentTags = multiTagSearch.value.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
                    currentTags.splice(index, 1);
                    multiTagSearch.value = currentTags.join(', ');
                    if (currentTags.length > 0) {
                        multiTagSearch.value += ', ';
                    }
                    handleMultiTagSearch();
                    break;
                case 'sort':
                    sortBy.value = 'upvotes-desc';
                    handleSort();
                    break;
            }
        }

        // Populate tag filter dropdown and store all tags
        function populateTagFilter() {
            const allTagsSet = new Set();
            
            allProducts.forEach(product => {
                product.tags.forEach(tag => {
                    if (tag.trim()) {
                        allTagsSet.add(tag.trim());
                    }
                });
            });
            
            allTags = Array.from(allTagsSet).sort();
            
            // Clear existing options except "All Tags"
            tagFilter.innerHTML = '<option value="">All Tags</option>';
            
            allTags.forEach(tag => {
                const option = document.createElement('option');
                option.value = tag;
                option.textContent = tag;
                tagFilter.appendChild(option);
            });
        }

        // Utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function hideLoading() {
            loading.style.display = 'none';
        }

        function showNoResults() {
            noResults.style.display = 'block';
            document.querySelector('.table-container').style.display = 'none';
        }

        function hideNoResults() {
            noResults.style.display = 'none';
            document.querySelector('.table-container').style.display = 'block';
        }

        function showError(message) {
            hideLoading();
            
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 0.25rem;"></i>
                    ${message}
                </div>
            `;
        }

        function hideError() {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = '';
        }
    </script>

    <!-- 
    GitHub Pages & Local Testing Setup Instructions:
    
    1. File Structure:
       your-repo/
       ├── index.html (this file)
       ├── products.json (default data file)
       └── json/
           ├── any-filename.json (auto-detected)
           ├── my-data.json (auto-detected)
           ├── test.json (auto-detected)
           ├── index.json (optional, for file metadata)
           └── ...any other .json files
    
    2. Local Testing with Python:
       - Put your .json files in the json/ folder
       - Run: python -m http.server 8000 (or python3 -m http.server 8000)
       - Open: http://localhost:8000
       - The app will auto-detect files via directory listing!
    
    3. Auto-Detection Methods (in order of preference):
       🗂️ Directory Listing: Reads actual folder contents (works with local servers)
       📋 Index File: Uses json/index.json for organized metadata
       📁 Pattern Scanning: Tests thousands of common filename patterns
       ✏️ Manual Addition: Users can add specific filenames
    
    4. Create json/index.json for organized file metadata (optional):
       {
         "files": [
           {
             "filename": "my-products.json",
             "name": "My Products",
             "description": "Custom product dataset"
           }
         ]
       }
    
    5. JSON file format (all files should follow this structure):
       [
         {
           "name": "Product Name",
           "description": "Product description", 
           "upvotes": 123,
           "comments": 45,
           "tags": ["tag1", "tag2", "tag3"],
           "url": "https://example.com"
         }
       ]
    
    6. Testing Tips:
       - Name your files descriptively: data.json, products-2024.json, etc.
       - Click the refresh button (🔄) to re-scan for new files
       - Use the + button to manually add specific filenames
       - Check browser console for scanning progress details
    
    7. GitHub Pages Deployment:
       - Works automatically once deployed
       - No server configuration needed
       - Uses pattern scanning + index.json approach
    -->

</body>
</html>